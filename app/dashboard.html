<!DOCTYPE html>
<html>
<head>
  <title>Store Insights Dashboard</title>
</head>
<body>
  <h1>Login to Store Insights</h1>

  <form id="loginForm">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Password" required />
    <button type="submit">Login</button>
  </form>

  <hr>

  <h2>Last 7 Days of Sales</h2>
  <table border="1" id="salesTable" style="display: none;">
    <thead>
      <tr>
        <th>Date</th>
        <th>Total Items Sold</th>
        <th>Total Sales ($)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let token = null;

    document.getElementById('loginForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const res = await fetch('https://store-insights.onrender.com/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });

      const data = await res.json();

      if (res.ok) {
        token = data.token;
        alert('Login successful!');
        loadSalesData();
      } else {
        alert(data.detail || 'Login failed.');
      }
    });

    async function loadSalesData() {
      const res = await fetch('https://store-insights.onrender.com/insights/sales', {
        headers: {
          'Authorization': 'Bearer ' + token
        }
      });

      const data = await res.json();

      if (!res.ok) {
        alert(data.detail || 'Failed to fetch sales.');
        return;
      }

      const table = document.getElementById('salesTable');
      const tbody = table.querySelector('tbody');
      tbody.innerHTML = '';

      data.sales.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.date}</td>
          <td>${row.total_items_sold}</td>
          <td>${row.total_sales.toFixed(2)}</td>
        `;
        tbody.appendChild(tr);
      });

      table.style.display = 'table';
    }
  </script>
</body>
</html>
