version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Installing Python dependencies..."
        - python -m pip install --upgrade pip
        - pip install -r requirements.txt
        - echo "Installing Node.js dependencies..."
        - npm install
    build:
      commands:
        - echo "Building frontend assets..."
        - npm run build:css:prod
        - echo "Building FastAPI application..."
        - python -c "from app.main import app; print('✅ FastAPI app loaded successfully')"
        - echo "✅ Build complete"
  artifacts:
    baseDirectory: /
    files:
      - '**/*'
  cache:
    paths:
      - '**/node_modules/**/*'
      - '.venv/**/*'
      - '**/__pycache__/**/*'
customHeaders:
  - pattern: '**/*.html'
    headers:
      - key: 'Cache-Control'
        value: 'no-cache, no-store, must-revalidate, max-age=0'
      - key: 'Pragma'
        value: 'no-cache'
      - key: 'Expires'
        value: '0'
  - pattern: '/api/**'
    headers:
      - key: 'Access-Control-Allow-Origin'
        value: '*'
      - key: 'Access-Control-Allow-Methods'
        value: 'GET, POST, PUT, DELETE, OPTIONS'
      - key: 'Access-Control-Allow-Headers'
        value: 'Content-Type, Authorization, X-Admin-Key'

